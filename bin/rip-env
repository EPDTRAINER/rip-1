#!/usr/bin/env ruby
## Usage: rip-env [-c] [-d] [-l] RIPENV
##
## Prints, changes, lists, creates, or deletes the ripenvs.

require 'rip/script'
require 'optparse'

if ARGV.empty?
  puts RIPENV
  exit
end

delete = false
ripenv = ARGV.detect { |arg| arg[0].chr != '-' }

ARGV.options do |o|
  o.on('-c', '--create') { exec "rip-create #{ripenv}" }
  o.on('-l', '--list')   { exec "rip-envs" }
  o.on('-d', '--delete') { delete = true }
  o.on('-h', '--help')   { exec "grep ^## < #$0 | cut -c4-" }
  o.parse!
end

abort "Can't find ripenv `#{ripenv}'" unless RIPENVS.include? ripenv

if delete && RIPENVS.size > 1
  if ripenv == RIPENV
    abort "Can't delete current ripenv."
  end

  exec "rm -rf #{Rip.dir}/#{ripenv}"
elsif delete
  abort "Can't delete only ripenv."
end

rm Rip.active rescue nil
ln_s "#{RIPDIR}/#{ripenv}", Rip.active
puts ripenv
