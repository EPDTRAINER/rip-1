#!/usr/bin/env ruby
# Usage: rip-fetch-dependencies PACKAGE
# Fetch dependencies with a breadth-first traversal

$-e = true

require 'rip/script'
require 'set'

fetched = []
queue   = []

original_package = ARGV[0]
queue << original_package

while queue.any?
  package_path = queue.shift
  fetched << package_path

  if package_path != original_package
    puts package_path
  end

  if File.exist?(deps = "#{package_path}/deps.rip")
    debug "found #{deps}"

    out = rip(:package, deps)
    out.split("\n").each do |dep_path|
      if !fetched.include?(dep_path) && !queue.include?(dep_path)
        queue << dep_path
      end
    end
  end
end
