#!/usr/bin/env ruby
# Usage: rip-fetch-git URL

require 'rip/script'

target = ARGV[0]

unless target
  abort "no git url given"
end

repo = Rip::GitPackage.new(target).cache_path

synchronize(repo) do
  if File.directory?(repo)
    cd repo
    git "fetch -q"
    puts repo
  elsif system("git clone --bare --mirror #{target} #{repo} &> /dev/null")
    puts repo
  else
    abort "#{target} not found"
  end
end
