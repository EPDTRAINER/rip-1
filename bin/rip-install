#!/usr/bin/env ruby
# Usage: rip-install PATH
# Installs a library into $RIPDIR/$RIPENV

$-e = true

require 'rip/script'

abort "what?" if ARGV.empty?

thing = ARGV * ' '
env   = Environment.new(thing)
paths = []

# Grab all dependencies
paths = rip("fetch-dependencies #{thing}").split("\n")

# See if we have any conflicts
rip "detect-conflicts #{paths * ' '}"

# Continue on.
env = Environment.new(paths)

# Install all else if not.
env.packages.each do |package|
  path = paths.shift
  rip "import #{path}"
  package = metadata(path)
  warn "installed #{package}"
end
