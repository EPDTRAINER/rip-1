#!/usr/bin/env ruby
# Usage: rip-install PATH
# Installs a library into $RIPDIR/$RIPENV
#
# Steps:
#   Calls `rip-installed PATH`
#   Fails if already installed
#   Calls `rip-fetch-dependencies deps.rip`
#   Calls `rip-detect-conflicts deps.rip`
#   Fails if conflicts exist
#   Calls `rip-import PATH`
#   Stores version, dependency, and files installed information in
#   $RIPDIR/$RIPENV/$RIPENV.ripenv

require 'rip/script'

env = Rip::Environment.new(ARGV[0])
# rip "fetch-dependencies #{env.path}"

env.packages.each do |package|
  path = sh "rip-package #{package.source} #{package.version}"
  puts path
  package.files = rip "import #{path}"
  Rip.ripenv[package.name] = package
  warn "Installed #{package}"
end

Rip.save_ripenv
