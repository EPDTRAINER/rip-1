#!/usr/bin/env ruby
# Usage: rip-install PATH
# Installs a library into $RIPDIR/$RIPENV
#
# Steps:
#   Infers the current version
#   Reads $RIPDIR/$RIPENV/$RIPENV.ripenv
#   Fails if PATH is already installed at a different version
#   Reads PATH/deps.rip
#   Calls rip-fetch on each dependency
#   Repeats for each dependency's deps.rip
#   Creates dependency mapping in memory
#   Checks for version mismatch between memory and ripenv
#   Fails if any mismatch detected
#   Copies PATH/lib/* PATH/bin/* and PATH/man/* to $RIPDIR/$RIPENV
#   Stores version, dependency, and files installed information in
#   $RIPDIR/$RIPENV/$RIPENV.ripenv

$LOAD_PATH.unshift File.dirname(__FILE__) + "/../lib"
require 'rip/script'

path = ARGV[0]
package = Package.new(path)

if installed = DB[package.name]
  $stderr.print "#{package} already installed at "
  $stderr.print installed['version']
  if installed['parents']
    $stderr.print " by "
    $stderr.print installed['parents'].join(' and ')
  end
  abort ""
end

puts package.version
