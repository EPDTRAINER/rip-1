#!/usr/bin/env ruby
# Usage: rip-installed PATH
# Determines whether a package is already installed or not.
# Exits 1 if so, 0 if not.
#
# Steps:
#   Infers the current version
#   Reads $RIPDIR/$RIPENV/$RIPENV.ripenv
#   Checks if PATH is already installed in the ripenv

require 'rip/script'

require 'set'

installed = Set.new

%w( lib bin man ).each do |type|
  Dir["#{Rip.envdir}/#{type}/**/*"].each do |file|
    if File.symlink?(file)
      package = File.readlink(file)[/^(#{Rip.packages}\/[^\/]+)/, 1]
      installed << package if package
    end
  end
end

puts installed.to_a if installed.any?
