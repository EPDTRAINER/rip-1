#!/usr/bin/env ruby
# Usage: rip-list [-p] RIPENV
#
# Displays all installed packages and their versions for RIPENV.
# If RIPENV is omitted shows installed packages for the current
# RIPENV.
#
# If -p is passed or standard out is redirect, prints in a "parseable"
# deps.rip format.
#
# If -m is passed, prints the minimal list of packages needed to
# duplicate the current ripenv.

require 'rip/script'

if ARGV.delete('-m')
  exec "rip-list-minimal"
end

parse = ARGV.delete('-p') || !$stdout.tty?

puts "ripenv: #{RIPENV}", "" unless parse

rip("installed").each do |package_path|
  if package = metadata(package_path)
    if parse
      puts "#{package.source} #{package.version(:long)}"
    else
      puts package
    end
  else
    warn "missing: #{package_path.chomp}" if parse.nil?
  end
end
